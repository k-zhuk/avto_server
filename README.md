# Проект "Автобот"

Построение аналитики производилось по следующим авто-площадкам объявлений:
- auto.ru
- avito авто
- drom
- сберавто

**Стек:** Python + MySQL

### Общее
Проект представляет собой собранный файл с аналитикой в формате PDF, который ежедневно приходит в телеграм канал.
В нем содержится сравнение площадок и аналика для каждой в отдельности за вчерашний и позавчерашний день.
Аналитика строилась по следующим срезам (для Санкт-Петербурга, гео +0 км.):

- новые / бу
- компания / частник (кроме сберавто)
- и кол-во объявлений всего

Пример такого отчета можно посмотреть в папке **report_backups**.
На момент 03.07.2023 в базе запись за 21 день работы **"Автобота"**.
Скрипты работают на удаленном сервере (VPS).

### Описание скриптов
- **avto_analytics.py** - парсит данные с площадок и записывает в базу. Также отправляется сообщение боту (только конкретному chat_id) с данными, которые записались в базу. Данные также дублируются в файл CSV. Запуск через крон (*/5 * * * *).
- **avto_report.py** - извлекает данные из базы за 2 предыдущих дня. SQL-запрос лежит в папке **sql_queries**. Формирует файл PDF с аналитикой. Отправляет сообщение в телеграм канал. Все отправленные отчеты дополнительно сохраняются в папку **report_backups**. Запуск через крон (50 8 * * *).
- **avto_handsend_report.py** - для ручной отправки отчета в телеграм канал при помощи кастомной команды бота. Запуск через крон (@reboot).

### Примеры из отчета
![analytics_compare](https://github.com/k-zhuk/avto_server/blob/develop/images/compare_analytics.png)
Для каждой из площадок показано сколько в среднем было объявлений вчера и позавчера. Снизу на оси Х показана разница в процентах (насколько изменилось среднее кол-во объявлений вчера по сравнению с позавчера.

---

![analytics_compare](https://github.com/k-zhuk/avto_server/blob/develop/images/used_new_example_2.png)
Цветная кривая показывает данные за вчера (yesterday), а серая за позавчера (yesterday - 1). В легенде в круглых скобках показывается среднее число объявлений. В заголовке графика p_value показывает является ли статистически значимым различия в кол-ве объявлений вчера и позавчера. Точками на графике обозначаются NaN значения, которые заменены на среднее.

---

![analytics_compare](https://github.com/k-zhuk/avto_server/blob/develop/images/used_new_example.png)
